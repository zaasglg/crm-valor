# üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å Telegram —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

## üö® –ü—Ä–æ–±–ª–µ–º–∞: –°–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
pm2 list

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
pm2 logs chat-clone --lines 20

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
chmod +x diagnose-telegram.sh
./diagnose-telegram.sh
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

#### 1. üîó –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤ (EADDRINUSE)
**–°–∏–º–ø—Ç–æ–º:** `Error: bind EADDRINUSE 0.0.0.0:3001`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç 3001
lsof -i :3001

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å
pm2 stop server  # –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å 'server'

# –ò–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç –¥–ª—è chat-clone
sed -i 's/PORT: 3001/PORT: 3002/g' ecosystem.config.js
sed -i 's/PORT=3001/PORT=3002/g' .env
```

#### 2. ü§ñ –ü—Ä–æ–±–ª–µ–º—ã —Å Telegram –±–æ—Ç–æ–º
**–°–∏–º–ø—Ç–æ–º—ã:** –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç, —Å–æ–æ–±—âÔøΩÔøΩ–Ω–∏—è –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
chmod +x fix-telegram.sh
./fix-telegram.sh
```

#### 3. üì° –ü—Ä–æ–±–ª–µ–º—ã —Å Webhook/Polling
**–°–∏–º–ø—Ç–æ–º:** –ë–æ—Ç –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è

**–î–ª—è POLLING (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
```bash
# –û—Ç–∫–ª—é—á–∏—Ç—å webhook
curl -X POST "https://api.telegram.org/bot<TOKEN>/deleteWebhook"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
pm2 restart chat-clone
```

**–î–ª—è WEBHOOK:**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook
curl -X POST "https://api.telegram.org/bot<TOKEN>/setWebhook" \
  -d "url=https://crm.valor-games.com/webhook/telegram"
```

#### 4. ‚öôÔ∏è –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env —Ñ–∞–π–ª:**
```bash
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:
TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞
SERVER_DOMAIN=https://crm.valor-games.com
PORT=3001
NODE_ENV=production
```

### –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ:

#### –®–∞–≥ 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤
```bash
pm2 stop chat-clone
pm2 delete chat-clone
pm2 stop server  # –µ—Å–ª–∏ –º–µ—à–∞–µ—Ç
pm2 start ecosystem.config.js
```

#### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram –±–æ—Ç–∞
```bash
./fix-telegram.sh
# –í—ã–±—Ä–∞—Ç—å —Ä–µ–∂–∏–º 1 (POLLING) –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã
```

#### –®–∞–≥ 3: –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–æ—Ä–æ–Ω–∫—É
```bash
# –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 3001:
node setup-colombia-funnel.js

# –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 3002:
SERVER_DOMAIN=http://localhost:3002 node setup-colombia-funnel.js
```

#### –®–∞–≥ 4: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
```bash
./test-funnel.sh
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:

1. **–°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:**
   ```bash
   pm2 list
   # chat-clone –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 'online'
   ```

2. **API –æ—Ç–≤–µ—á–∞–µ—Ç:**
   ```bash
   curl http://localhost:3001/api/automation-rules
   # –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å JSON —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏
   ```

3. **–ë–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω:**
   ```bash
   curl "https://api.telegram.org/bot<TOKEN>/getMe"
   # –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ
   ```

4. **–¢–µ—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:**
   - –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É –≤ Telegram
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `pm2 logs chat-clone -f`
   - –î–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ç C√©sar G√≥mez

### –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç:

```bash
# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞
pm2 stop chat-clone
pm2 delete chat-clone
rm -rf node_modules
npm install --production
pm2 start ecosystem.config.js

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –≤–æ—Ä–æ–Ω–∫–∏
node setup-colombia-funnel.js
```

### –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏:
- –õ–æ–≥–∏: `pm2 logs chat-clone -f`
- –°—Ç–∞—Ç—É—Å: `pm2 monit`
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: `cat .env`
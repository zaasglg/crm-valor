#!/bin/bash

echo "üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –≤–æ—Ä–æ–Ω–∫–∏ –ö–æ–ª—É–º–±–∏—è..."

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä..."
pm2 restart chat-clone

# –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞
sleep 5

# –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–æ—Ä–æ–Ω–∫—É
echo "üìã –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–æ—Ä–æ–Ω–∫—É..."
node setup-colombia-funnel.js

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
echo ""
echo "‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç:"
RULES_COUNT=$(curl -s http://localhost:3001/api/automation-rules | jq '. | length' 2>/dev/null || echo "0")
echo "–ü—Ä–∞–≤–∏–ª –∑–∞–≥—Ä—É–∂–µ–Ω–æ: $RULES_COUNT"

if [ "$RULES_COUNT" -gt "0" ]; then
    echo "‚úÖ –í–æ—Ä–æ–Ω–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!"
    
    echo ""
    echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:"
    echo "1. –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É: '–ø—Ä–∏–≤–µ—Ç' –∏–ª–∏ 'hello'"
    echo "2. –î–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ç C√©sar G√≥mez"
    echo "3. –õ–æ–≥–∏: pm2 logs chat-clone -f"
else
    echo "‚ùå –í–æ—Ä–æ–Ω–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å"
    echo "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ: ./fix-rules-sync.sh"
fi
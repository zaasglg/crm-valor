class MessageClassifier {
  constructor() {
    this.tags = [
      'оплата',
      'доставка', 
      'жалоба',
      'техподдержка',
      'повторный заказ',
      'информация о товаре',
      'отмена заказа',
      'возврат',
      'консультация',
      'общий вопрос'
    ];

    this.keywords = {
      'оплата': ['оплата', 'деньги', 'счет', 'перевод', 'карта', 'стоимость', 'цена', 'сколько', 'платить', 'оплатить', 'банк', 'рубл', 'доллар', 'евро', 'тариф', 'скидка', 'промокод'],
      'доставка': ['доставка', 'курьер', 'почта', 'адрес', 'когда привезут', 'отследить', 'трек', 'номер заказа', 'получить', 'забрать', 'пункт выдачи', 'срок доставки'],
      'жалоба': ['плохо', 'ужасно', 'не работает', 'сломан', 'брак', 'некачественно', 'возмущен', 'недоволен', 'жалоба', 'претензия', 'обман', 'мошенники'],
      'техподдержка': ['не работает', 'ошибка', 'баг', 'сайт', 'приложение', 'войти', 'регистрация', 'пароль', 'технические', 'глючит', 'зависает', 'не загружается'],
      'повторный заказ': ['снова', 'еще раз', 'повторно', 'как в прошлый раз', 'такой же', 'заказывал', 'покупал', 'брал ранее'],
      'информация о товаре': ['характеристики', 'размер', 'цвет', 'материал', 'состав', 'описание', 'фото', 'видео', 'отзывы', 'есть ли в наличии'],
      'отмена заказа': ['отменить', 'не нужно', 'передумал', 'отказаться', 'аннулировать'],
      'возврат': ['вернуть', 'возврат', 'не подошло', 'обменять', 'не то', 'другой размер'],
      'консультация': ['посоветуйте', 'что выбрать', 'какой лучше', 'помогите выбрать', 'рекомендации'],
      'общий вопрос': []
    };
  }

  classify(message) {
    const text = message.toLowerCase();
    const foundTags = [];

    for (const [tag, keywords] of Object.entries(this.keywords)) {
      if (tag === 'общий вопрос') continue;
      
      const hasKeyword = keywords.some(keyword => text.includes(keyword));
      if (hasKeyword) {
        foundTags.push(tag);
      }
    }

    if (foundTags.length === 0) {
      foundTags.push('общий вопрос');
    }

    return { tags: foundTags };
  }
}

module.exports = MessageClassifier;
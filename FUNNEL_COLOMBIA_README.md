# Воронка Колумбия - Chicken Road

## Описание
Автоматизированная воронка для привлечения клиентов в Колумбии с предложением приложения для игры Chicken Road.

## Структура воронки

### Этап 1: Старт → 1смс
- **Событие**: Открытие чата (`chat_opened`)
- **Действие**: Отправка приветственного сообщения от César Gómez
- **Тег**: Добавляется `1смс`

### Этап 2: Ответ на 1смс → 2смс  
- **Событие**: Получение любого сообщения (`message_received`)
- **Условие**: Наличие тега `1смс`
- **Действие**: Отправка информации о методе и возможной прибыли
- **Теги**: Удаляется `1смс`, добавляется `2смс`

### Этап 3: Ответ на 2смс → регистрация
- **Событие**: Получение любого сообщения (`message_received`) 
- **Условие**: Наличие тега `2смс`
- **Действие**: Отправка ссылки на регистрацию и запрос скриншота
- **Теги**: Удаляется `2смс`, добавляется `регистрация`

### Этап 4: Прошел регу → демо
- **Событие**: Добавление тега (`tag_added`)
- **Условие**: Наличие тега `Прошел регу Колумбия` 
- **Действие**: Отправка демо-приложения
- **Примечание**: Тег проставляется менеджером вручную

### Этап 5: Переходная воронка ФД→РД
- **Событие**: Добавление тега (`tag_added`)
- **Условие**: Наличие тега `переход_к_рд`
- **Действие**: Активация полной версии приложения с инструкциями
- **Примечание**: Тег проставляется при передаче от FD к RD менеджеру

## Установка и запуск

### 1. Запуск сервера
```bash
cd /Users/erdaulet/Desktop/crm/chat_clone
npm start
# или
node server.js
```

### 2. Загрузка воронки
```bash
node setup-colombia-funnel.js
```

### 3. Проверка правил
Откройте в браузере: http://localhost:3000/admin/automation

## Файлы воронки

- `funnel-schemas/colombia-chicken-road.json` - JSON схема воронки
- `setup-colombia-funnel.js` - Скрипт установки воронки  
- `load-funnel-schema.js` - Базовый загрузчик схем
- `FUNNEL_COLOMBIA_README.md` - Данная документация

## Особенности реализации

### Задержки сообщений
Сообщения отправляются с задержками:
- Первое сообщение: сразу (delay: 0)
- Последующие: через 2 секунды (delay: 2000)

### Теги для отслеживания этапов
- `1смс` - клиент получил первое сообщение
- `2смс` - клиент ответил на первое сообщение  
- `регистрация` - клиент ответил на второе сообщение
- `Прошел регу Колумбия` - менеджер подтвердил регистрацию
- `переход_к_рд` - передача от FD к RD менеджеру

### Ручные действия менеджера
Некоторые этапы требуют ��учного вмешательства:
1. Проставление тега `Прошел регу Колумбия` после проверки скриншота
2. Проставление тега `переход_к_рд` при передаче клиента

## Мониторинг и отладка

Логи автоматизации можно отслеживать в консоли сервера. Каждое срабатывание правила записывается с подробной информацией о событии и выполненных действиях.

## Модификация воронки

Для изменения воронки:
1. Отредактируйте файл `funnel-schemas/colombia-chicken-road.json`
2. Перезапустите скрипт `setup-colombia-funnel.js`
3. Или добавьте правила через веб-интерфейс администратора